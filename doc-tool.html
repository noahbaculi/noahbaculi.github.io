<!DOCTYPE HTML>
<html>

	<head>
		<title>Noah - Document Tool</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1,
			user-scalable=no">
		<meta name="description" content="Noah's Document Tool">
		<link rel="stylesheet" href="assets/css/main.css">
		<noscript>
			<link rel="stylesheet" href="assets/css/noscript.css">
		</noscript>
		<link rel="icon" href="./images/icons/favicon_50_w.webp">
	</head>

	<body class="is-preload">
		<!-- Wrapper -->
		<div id="wrapper">
			<div id="headers"></div>
			<link
				href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.1/css/font-awesome.min.css"
				media="all"
				rel="stylesheet" type="text/css" lazyload>
			<!-- Main -->
			<div id="main">
				<div class="inner">
					<br>
					<br>
					<h5>Find / Replace in Word Documents</h5>
					<br>
					<form name="documentToolForm" id="documentToolForm">
						<table>
							<tbody>
								<tr>
									<td>
										<label for="template_file">Template File (.docx)</label>
									</td>
									<td>
										<input type="file" name="template_file" id="template_file"
											accept=".docx" required>
									</td>
								</tr>
								<tr>
									<td>
										<label for="replacements_file">Replacements File (.csv)</label>
									</td>
									<td>
										<input type="file"
											name="replacements_file" id="replacements_file" accept=".csv"
											required>
									</td>
								</tr>
								<tr>
									<td>
										<label for="output_base_fn">Output Base Filename</label>
									</td>
									<td>
										<input type="text" name="output_base_fn"
											id="output_base_fn" maxlength="50" size="30"
											placeholder="John Doe Cover Letter">
									</td>
								</tr>
							</tbody>
						</table>
						<div data-netlify-recaptcha="true"></div><br>
						<div class="align-center"><input type="submit" value="Upload"></div>
					</form>
				</div>
				<br><br>
				<div class="row">
					<a href="#top" style="margin-left: 90vw;">
						<img srcset="
							./images/icons/icon_scroll_up_25_w.webp 25w,
							./images/icons/icon_scroll_up_50_w.webp 1000w" sizes="1.5em"
							loading="lazy" decoding="async"
							src="./images/icons/icon_scroll_up.png" class="scroll_icon" alt="Scroll
							Up"
							style="position: inherit;">
					</a>
				</div>
			</div>
			<!-- Footer -->
			<footer id="footer"></footer>
		</div>
		<!-- Scripts -->
		<script src="assets/js/jquery.min.js"></script>
		<script src="assets/js/browser.min.js"></script>
		<script src="assets/js/breakpoints.min.js"></script>
		<script src="assets/js/util.js"></script>
		<script src="assets/js/main.js"></script>
		<script>
			const thisForm = document.getElementById('documentToolForm');
			thisForm.addEventListener('submit', async function (e) {
				e.preventDefault();
				
				const formData = new FormData();
				formData.append("template_file", document.getElementById('template_file').files[0]);
				formData.append("replacements_file", document.getElementById('replacements_file').files[0]);
				formData.append("output_base_fn", document.getElementById("output_base_fn").value);

				const output_zip_fn = "generated_documents.zip"
				formData.append("output_zip_fn", output_zip_fn);


				const request = new XMLHttpRequest();
				request.open("POST", "https://doc-find-replace.herokuapp.com/", true);
				// request.onreadystatechange = () => {
				// 	if (request.readyState === 4 && request.status === 200) {
				// 		console.log(request.responseText);
				// 	}
				// };
				request.responseType = 'blob';
				request.onload = function (e) {
					var blob = request.response;
					var link=document.createElement('a');
					link.href=window.URL.createObjectURL(blob);
					link.download=output_zip_fn;
					link.click();
				}
				request.send(formData);

				// console.log(document.getElementById('template_file').files[0])
				// for (const pair of formdata.entries()) {
				// 	console.log(`${pair[0]}, ${pair[1]}`);
				// }
				// console.log(formdata)

				// const requestOptions = {
				// method: 'POST',
				// body: formdata,
				// redirect: 'follow'
				// };

				// fetch("https://doc-find-replace.herokuapp.com/", requestOptions)
				// 	.then(response => response)
				// 	.then(success => console.log(success))
				// 	.catch(error => console.log(error));





				// fetch("https://doc-find-replace.herokuapp.com/", requestOptions)
				// 	.then(response => response.text())
				// 	.then(result => console.log(result))
				// 	.catch(error => console.log('error', error));
			});

		</script>
	</body>

</html>